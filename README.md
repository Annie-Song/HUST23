# HUST23  
## 介绍
基于Web的互联网广告平台（Web开发）

### 开发者
**负责人**：宋媛媛  
**前端**：黄雄亮  
**后端**：雷畅  
**数据库**：曾云馨  

## 架构
![简易架构图](https://github.com/user-attachments/assets/04086da8-7b76-42fb-b8b0-ab8ead16b0b8)

---

# 广告平台需求文档  
**版本：** 1.0  
**最后更新：** 2023年8月15日  
**目标读者：** 开发团队、技术负责人、测试团队  

---

## 一、项目概述  

### 1.1 背景  
构建一个支持多角色协作的互联网广告管理平台，实现广告的创建、投放、审核、数据统计全流程管理，满足广告主、审核人员、运营人员的使用需求。  

### 1.2 目标  
1. 提供广告全生命周期管理功能（创建-审核-上线-下架）  
2. 实现基于角色的权限控制（广告主/审核员/管理员）  
3. 支持广告数据的实时统计与分析  
4. 保障系统高可用性（99.9% SLA）与数据安全性  

---

## 二、功能需求  

### 2.1 核心功能模块  
| 模块           | 功能描述                                                                 | 优先级 |
|----------------|--------------------------------------------------------------------------|--------|
| **广告管理**   | 广告创建、编辑、状态变更（草稿/提交审核/上线/下架）                       | P0     |
| **审核管理**   | 广告内容审核（人工+自动化）、审核记录追踪                                 | P0     |
| **数据统计**   | 曝光量、点击量、点击率（CTR）的实时/历史数据展示                          | P1     |
| **用户权限**   | 基于角色的访问控制（RBAC），支持权限组动态配置                            | P0     |
| **文件管理**   | 广告素材上传（图片/视频）、格式校验、存储管理                             | P1     |

### 2.2 详细功能说明  
#### 广告管理（P0）  
- **创建广告**  
  - 输入：标题、内容、预算、定向条件（地域/人群）  
  - 限制：单个用户每日最多创建50条广告  
  - 输出：生成唯一广告ID及审核编号  

- **状态变更流程**  
  ```mermaid
  graph LR
    A[草稿] -->|提交| B(待审核)
    B -->|通过| C[已上线]
    B -->|驳回| A
    C -->|手动下架| D[已结束]
    C -->|预算耗尽| D
  ```

---

## 三、系统架构  

### 3.1 技术栈  
| 层级         | 技术选型                              | 说明                          |
|--------------|-------------------------------------|-------------------------------|
| **前端**     | HTML/CSS/JavaScript                 | 纯原生实现，无框架依赖          |
| **后端**     | Node.js + Express                   | RESTful API 接口               |
| **数据库**   | MySQL 8.0                          | 关系型数据存储                 |
| **缓存**     | Redis 6                            | 会话管理/热点数据缓存           |
| **部署**     | Docker + Nginx                     | 容器化编排与反向代理            |

### 3.2 架构图  
```plaintext
+--------------+       +--------------+       +---------------+
|   Client     |       |   Admin      |       |   Ad Display  |
| (React SPA)  |       | (Vue.js)     |       | (Static HTML) |
+------+-------+       +------+-------+       +-------+-------+
       |                      |                       |
       | HTTP/HTTPS           | HTTP/HTTPS            |
       v                      v                       v
+------+----------------------+-----------------------+-------+
|                          API Gateway                         |
|                     (Node.js + Express)                      |
+------------------------------+-------------------------------+
                               |
                +--------------+--------------+
                |           Services          |
                +--------------+--------------+
                               |
                +--------------+--------------+
                |        Data Layer           |
                |  MySQL           Redis      |
                +-----------------------------+
```

---

## 四、数据模型  

### 4.1 核心表结构  
#### 广告表 (`ads`)  
| 字段名         | 类型          | 说明                          |
|----------------|---------------|-------------------------------|
| id             | CHAR(36)      | UUID主键                     |
| title          | VARCHAR(100)  | 广告标题（唯一约束）          |
| content        | TEXT          | HTML格式广告内容              |
| status         | ENUM          | 状态值：draft/pending/active  |
| daily_budget   | DECIMAL(12,2) | 日预算（单位：元）            |
| created_at     | DATETIME      | 创建时间（索引）              |

### 4.2 查询优化方案  
- **高频查询**：为`status + created_at`建立复合索引  
- **统计查询**：使用物化视图预计算每日聚合数据  

---

## 五、接口规范  

### 5.1 认证机制  
- **JWT Token** 通过 `Authorization: Bearer <token>` 传递  
- Token 有效期：2小时（刷新令牌机制）  

### 5.2 核心接口示例  
#### 创建广告 (POST `/api/v1/ads`)  
**请求体：**  
```json
{
  "title": "秋季大促",
  "content": "<div>限时折扣...</div>",
  "budget": 10000.00,
  "targeting": {
    "regions": ["北京", "上海"],
    "min_age": 20
  }
}
```

**成功响应：**  
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "review_code": "A20230815-001"
}
```

**错误码：**  
- `4001 INVALID_TOKEN` - 令牌无效  
- `4102 BUDGET_EXCEEDED` - 超出单日预算上限  

---

## 六、非功能需求  

### 6.1 性能指标  
| 场景                   | 要求                     |
|------------------------|--------------------------|
| API平均响应时间        | ≤ 300ms (P95)           |
| 广告列表查询（万级数据）| ≤ 1s                    |
| 系统可用性             | ≥ 99.9% (按月计算)      |

### 6.2 安全要求  
- **数据加密**：敏感字段（如密码）使用 bcrypt 哈希存储  
- **速率限制**：关键接口 100次/分钟/IP  
- **审计日志**：记录所有管理员操作  

---

## 七、部署与运维  

### 7.1 环境配置  
| 环境   | 服务器规格          | 节点数 | 说明                |
|--------|---------------------|--------|---------------------|
| 开发   | 2vCPU 4GB          | 1      | 本地Docker部署      |
| 测试   | 4vCPU 8GB          | 2      | 负载均衡            |
| 生产   | 8vCPU 16GB         | 4+     | 自动扩缩容集群      |

### 7.2 监控方案  
- **基础设施监控**：Prometheus + Grafana  
- **日志分析**：ELK Stack（保留180天日志）  
- **告警规则**：  
  - CPU使用率 > 80% 持续5分钟  
  - API错误率 > 1% 持续10分钟  

---

## 八、附录  

### 8.1 术语表  
| 术语       | 说明                                  |
|------------|---------------------------------------|
| CTR        | 点击率（Click-Through Rate）          |
| RTB        | 实时竞价（Real-Time Bidding）         |
| SLA        | 服务等级协议（Service Level Agreement）|

### 8.2 参考文档  
- [OpenAPI 规范文档](api-spec.yaml)  
- [数据库迁移指南](db-migration.md)  

--- 

**文档批准**  
技术负责人：___________  日期：___________
